/*!
 * Stockfish copyright T. Romstad, M. Costalba, J. Kiiski, G. Linscott
 * and other contributors.
 *
 * Released under the GNU General Public License v3.
 *
 * Compiled to JavaScript and WebAssembly by Niklas Fiekas
 * <niklas.fiekas@backscattering.de> using Emscripten.
 *
 * https://github.com/lichess-org/stockfish.wasm
 */

var Stockfish = (() => {
  var _scriptName = typeof document != 'undefined' ? document.currentScript?.src : undefined;
  if (typeof __filename != 'undefined') _scriptName ||= __filename;
  return (
function(moduleArg = {}) {
  var moduleRtn;

function aa(){f.buffer!=k.buffer&&m();return k}function n(){f.buffer!=k.buffer&&m();return ba}function ca(){f.buffer!=k.buffer&&m();return da}function q(){f.buffer!=k.buffer&&m();return ea}function fa(){f.buffer!=k.buffer&&m();return ha}var r=moduleArg,ia,t,ja=new Promise((a,b)=>{ia=a;t=b}),ka="object"==typeof window,u="function"==typeof importScripts,v="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,w=u&&"em-pthread"==self.name;
if(v){var z=require("worker_threads");global.Worker=z.Worker;w=(u=!z.$)&&"em-pthread"==z.workerData}
(function(){function a(){var d=e.shift();if(!b&&void 0!==d){if("quit"===d)return r.terminate();var h=r.ccall("uci_command","number",["string"],[d]);h&&e.unshift(d);g=h?2*g:1;setTimeout(a,g)}}var b=!1,c=[];r.print=function(d){0===c.length?console.log(d):setTimeout(function(){for(var h=0;h<c.length;h++)c[h](d)})};r.addMessageListener=function(d){c.push(d)};r.removeMessageListener=function(d){d=c.indexOf(d);0<=d&&c.splice(d,1)};r.terminate=function(){b=!0;la()};var e=[],g=1;r.postMessage=function(d){e.push(d)};
r.postRun=function(){r.postMessage=function(d){e.push(d);1===e.length&&a()};a()}})();var ma=Object.assign({},r),na=[],A="./this.program",oa=(a,b)=>{throw b;},B="",pa,C;
if(v){var fs=require("fs"),qa=require("path");B=__dirname+"/";C=a=>{a=ra(a)?new URL(a):qa.normalize(a);return fs.readFileSync(a)};pa=a=>{a=ra(a)?new URL(a):qa.normalize(a);return new Promise((b,c)=>{fs.readFile(a,void 0,(e,g)=>{e?c(e):b(g.buffer)})})};!r.thisProgram&&1<process.argv.length&&(A=process.argv[1].replace(/\\/g,"/"));na=process.argv.slice(2);oa=(a,b)=>{process.exitCode=a;throw b;}}else if(ka||u)u?B=self.location.href:"undefined"!=typeof document&&document.currentScript&&(B=document.currentScript.src),
_scriptName&&(B=_scriptName),B.startsWith("blob:")?B="":B=B.substr(0,B.replace(/[?#].*/,"").lastIndexOf("/")+1),v||(u&&(C=a=>{var b=new XMLHttpRequest;b.open("GET",a,!1);b.responseType="arraybuffer";b.send(null);return new Uint8Array(b.response)}),pa=a=>fetch(a,{credentials:"same-origin"}).then(b=>b.ok?b.arrayBuffer():Promise.reject(Error(b.status+" : "+b.url))));v&&"undefined"==typeof performance&&(global.performance=require("perf_hooks").performance);var sa=console.log.bind(console),ta=console.error.bind(console);
v&&(sa=(...a)=>fs.writeSync(1,a.join(" ")+"\n"),ta=(...a)=>fs.writeSync(2,a.join(" ")+"\n"));var ua=r.print||sa,D=r.printErr||ta;Object.assign(r,ma);ma=null;r.arguments&&(na=r.arguments);r.thisProgram&&(A=r.thisProgram);
if(w){var va;if(v){var wa=z.parentPort;wa.on("message",c=>onmessage({data:c}));Object.assign(globalThis,{self:global,importScripts:()=>{},postMessage:c=>wa.postMessage(c),performance:global.performance||{now:Date.now}})}var xa=!1;function a(...c){c=c.join(" ");v?fs.writeSync(2,c+"\n"):console.error(c)}r.printErr||(D=a);self.alert=function(...c){postMessage({U:"alert",text:c.join(" "),aa:E()})};r.instantiateWasm=(c,e)=>new Promise(g=>{va=d=>{d=new WebAssembly.Instance(d,ya());e(d);g()}});self.onunhandledrejection=
c=>{throw c.reason||c;};function b(c){try{var e=c.data,g=e.cmd;if("load"===g){let d=[];self.onmessage=h=>d.push(h);self.startWorker=()=>{postMessage({cmd:"loaded"});for(let h of d)b(h);self.onmessage=b};for(const h of e.handlers)if(!r[h]||r[h].proxy)r[h]=(...l)=>{postMessage({U:"callHandler",Z:h,args:l})},"print"==h&&(ua=r[h]),"printErr"==h&&(D=r[h]);f=e.wasmMemory;m();va(e.wasmModule)}else if("run"===g){za(e.pthread_ptr,0,0,1,0,0);Aa(e.pthread_ptr);Ba();Ca();xa||=!0;try{Da(e.start_routine,e.arg)}catch(d){if("unwind"!=
d)throw d;}}else"cancel"===g?E()&&F(-1):"setimmediate"!==e.target&&("checkMailbox"===g?xa&&G():g&&(D(`worker: received unknown command ${g}`),D(e)))}catch(d){throw Ea(),d;}}self.onmessage=b}var H=r.wasmBinary,f,Fa,I=!1,J,k,ba,da,ea,ha;
function m(){var a=f.buffer;r.HEAP8=k=new Int8Array(a);r.HEAP16=new Int16Array(a);r.HEAPU8=ba=new Uint8Array(a);r.HEAPU16=new Uint16Array(a);r.HEAP32=da=new Int32Array(a);r.HEAPU32=ea=new Uint32Array(a);r.HEAPF32=new Float32Array(a);r.HEAPF64=ha=new Float64Array(a)}
if(!w){if(r.wasmMemory)f=r.wasmMemory;else if(f=new WebAssembly.Memory({initial:(r.INITIAL_MEMORY||71303168)/65536,maximum:32768,shared:!0}),!(f.buffer instanceof SharedArrayBuffer))throw D("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),v&&D("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and/or recent version)"),
Error("bad memory");m()}var Ga=[],Ha=[],Ia=[],Ja=[],K=0,Ka=null,L=null;function La(){K++;r.monitorRunDependencies?.(K)}function Ma(){K--;r.monitorRunDependencies?.(K);if(0==K&&(null!==Ka&&(clearInterval(Ka),Ka=null),L)){var a=L;L=null;a()}}function Na(a){r.onAbort?.(a);a="Aborted("+a+")";D(a);I=!0;J=1;a=new WebAssembly.RuntimeError(a+". Build with -sASSERTIONS for more info.");t(a);throw a;}var Oa=a=>a.startsWith("data:application/octet-stream;base64,"),ra=a=>a.startsWith("file://"),Pa;
function Qa(a){if(a==Pa&&H)return new Uint8Array(H);if(C)return C(a);throw"both async and sync fetching of the wasm failed";}function Ra(a){return H?Promise.resolve().then(()=>Qa(a)):pa(a).then(b=>new Uint8Array(b),()=>Qa(a))}function Sa(a,b,c){return Ra(a).then(e=>WebAssembly.instantiate(e,b)).then(c,e=>{D(`failed to asynchronously prepare wasm: ${e}`);Na(e)})}
function Ta(a,b){var c=Pa;return H||"function"!=typeof WebAssembly.instantiateStreaming||Oa(c)||v||"function"!=typeof fetch?Sa(c,a,b):fetch(c,{credentials:"same-origin"}).then(e=>WebAssembly.instantiateStreaming(e,a).then(b,function(g){D(`wasm streaming compile failed: ${g}`);D("falling back to ArrayBuffer instantiation");return Sa(c,a,b)}))}
function ya(){Ua={A:Va,f:Wa,v:Xa,w:Ya,B:Za,k:$a,i:ab,z:bb,j:cb,o:db,g:eb,h:Aa,t:fb,p:gb,q:hb,d:ib,l:jb,b:kb,y:lb,r:mb,s:nb,c:M,e:ob,u:pb,m:qb,x:rb,a:f,n:sb};return{a:Ua}}function tb(a){this.name="ExitStatus";this.message=`Program terminated with exit(${a})`;this.status=a}
var ub=a=>{a.terminate();a.onmessage=()=>{}},xb=a=>{0==N.length&&(vb(),wb(N[0]));var b=N.pop();if(!b)return 6;O.push(b);P[a.T]=b;b.T=a.T;var c={cmd:"run",start_routine:a.W,arg:a.V,pthread_ptr:a.T};v&&b.unref();b.postMessage(c,a.X);return 0},Q=0,T=(a,b,...c)=>{for(var e=c.length,g=yb(),d=R(8*e),h=d>>3,l=0;l<c.length;l++){var x=c[l];fa()[h+l]=x}a=zb(a,0,e,d,b);S(g);return a};function sb(a){if(w)return T(0,1,a);J=a;U||0<Q||(la(),r.onExit?.(a),I=!0);oa(a,new tb(a))}
var Ab=a=>{a instanceof tb||"unwind"==a||oa(1,a)};function Bb(a){if(w)return T(1,0,a);M(a)}var M=a=>{J=a;if(w)throw Bb(a),"unwind";sb(a)},N=[],O=[],Cb=[],P={};function Db(){for(var a=1;a--;)vb();Ga.unshift(()=>{La();Eb(()=>Ma())})}var la=()=>{for(var a of O)ub(a);for(a of N)ub(a);N=[];O=[];P=[]},Gb=a=>{var b=a.T;delete P[b];N.push(a);O.splice(O.indexOf(a),1);a.T=0;Fb(b)};function Ca(){Cb.forEach(a=>a())}
var wb=a=>new Promise(b=>{a.onmessage=d=>{d=d.data;var h=d.cmd;if(d.targetThread&&d.targetThread!=E()){var l=P[d.targetThread];l?l.postMessage(d,d.transferList):D(`Internal error! Worker sent a message "${h}" to target pthread ${d.targetThread}, but that thread no longer exists!`)}else if("checkMailbox"===h)G();else if("spawnThread"===h)xb(d);else if("cleanupThread"===h)Gb(P[d.thread]);else if("killThread"===h)d=d.thread,h=P[d],delete P[d],ub(h),Fb(d),O.splice(O.indexOf(h),1),h.T=0;else if("cancelThread"===
h)P[d.thread].postMessage({cmd:"cancel"});else if("loaded"===h)a.loaded=!0,v&&!a.T&&a.unref(),b(a);else if("alert"===h)alert(`Thread ${d.threadId}: ${d.text}`);else if("setimmediate"===d.target)a.postMessage(d);else if("callHandler"===h)r[d.handler](...d.args);else h&&D(`worker sent an unknown command ${h}`)};a.onerror=d=>{D(`${"worker sent an error!"} ${d.filename}:${d.lineno}: ${d.message}`);throw d;};v&&(a.on("message",d=>a.onmessage({data:d})),a.on("error",d=>a.onerror(d)));var c=[],e=["onExit",
"onAbort","print","printErr"],g;for(g of e)r.propertyIsEnumerable(g)&&c.push(g);a.postMessage({cmd:"load",handlers:c,wasmMemory:f,wasmModule:Fa})});function Eb(a){w?a():Promise.all(N.map(wb)).then(a)}function vb(){var a=_scriptName;r.mainScriptUrlOrBlob&&(a=r.mainScriptUrlOrBlob,"string"!=typeof a&&(a=URL.createObjectURL(a)));a=new Worker(a,{workerData:"em-pthread",name:"em-pthread"});N.push(a)}
var V=a=>{for(;0<a.length;)a.shift()(r)},Ba=()=>{var a=E(),b=q()[a+52>>2];a=q()[a+56>>2];Hb(b,b-a);S(b)},W=[],Ib,Da=(a,b)=>{Q=0;var c=W[a];c||(a>=W.length&&(W.length=a+1),W[a]=c=Ib.get(a));a=c(b);U||0<Q?J=a:F(a)},U=r.noExitRuntime||!0;function Jb(a,b,c,e){return w?T(2,1,a,b,c,e):Va(a,b,c,e)}
var Va=(a,b,c,e)=>{if("undefined"==typeof SharedArrayBuffer)return D("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var g=[];if(w&&0===g.length)return Jb(a,b,c,e);a={W:c,T:a,V:e,X:g};return w?(a.U="spawnThread",postMessage(a,g),0):xb(a)},Kb="undefined"!=typeof TextDecoder?new TextDecoder:void 0,Lb=(a,b)=>{for(var c=b+NaN,e=b;a[e]&&!(e>=c);)++e;if(16<e-b&&a.buffer&&Kb)return Kb.decode(a.buffer instanceof SharedArrayBuffer?a.slice(b,e):a.subarray(b,e));for(c=
"";b<e;){var g=a[b++];if(g&128){var d=a[b++]&63;if(192==(g&224))c+=String.fromCharCode((g&31)<<6|d);else{var h=a[b++]&63;g=224==(g&240)?(g&15)<<12|d<<6|h:(g&7)<<18|d<<12|h<<6|a[b++]&63;65536>g?c+=String.fromCharCode(g):(g-=65536,c+=String.fromCharCode(55296|g>>10,56320|g&1023))}}else c+=String.fromCharCode(g)}return c};function Wa(a,b,c){return w?T(3,1,a,b,c):0}function Xa(a,b,c){return w?T(4,1,a,b,c):0}function Ya(a,b,c,e){if(w)return T(5,1,a,b,c,e)}
var Za=()=>{Na("")},$a=()=>1,ab=a=>{za(a,!u,1,!ka,65536,!1);Ca()},Mb=a=>{if(!I)try{if(a(),!(U||0<Q))try{w?F(J):M(J)}catch(b){Ab(b)}}catch(b){Ab(b)}},Aa=a=>{"function"===typeof Atomics.Y&&(Atomics.Y(ca(),a>>2,a).value.then(G),a+=128,Atomics.store(ca(),a>>2,1))},G=()=>{var a=E();a&&(Aa(a),Mb(Nb))},bb=(a,b)=>{a==b?setTimeout(G):w?postMessage({targetThread:a,cmd:"checkMailbox"}):(a=P[a])&&a.postMessage({cmd:"checkMailbox"})},Ob=[],cb=(a,b,c,e,g)=>{Ob.length=e;b=g>>3;for(c=0;c<e;c++)Ob[c]=fa()[b+c];return(0,Pb[a])(...Ob)};
function db(){if(w)return T(6,1);U=!1;Q=0}var eb=a=>{w?postMessage({cmd:"cleanupThread",thread:a}):Gb(P[a])},fb=a=>{v&&P[a].ref()},X={},kb;kb=()=>performance.timeOrigin+performance.now();function gb(a,b){if(w)return T(7,1,a,b);X[a]&&(clearTimeout(X[a].id),delete X[a]);if(!b)return 0;var c=setTimeout(()=>{delete X[a];Mb(()=>Qb(a,kb()))},b);X[a]={id:c,ba:b};return 0}
var Y=(a,b,c)=>{var e=n();if(0<c){c=b+c-1;for(var g=0;g<a.length;++g){var d=a.charCodeAt(g);if(55296<=d&&57343>=d){var h=a.charCodeAt(++g);d=65536+((d&1023)<<10)|h&1023}if(127>=d){if(b>=c)break;e[b++]=d}else{if(2047>=d){if(b+1>=c)break;e[b++]=192|d>>6}else{if(65535>=d){if(b+2>=c)break;e[b++]=224|d>>12}else{if(b+3>=c)break;e[b++]=240|d>>18;e[b++]=128|d>>12&63}e[b++]=128|d>>6&63}e[b++]=128|d&63}}e[b]=0}},hb=(a,b,c,e)=>{var g=(new Date).getFullYear(),d=(new Date(g,0,1)).getTimezoneOffset();g=(new Date(g,
6,1)).getTimezoneOffset();var h=Math.max(d,g);q()[a>>2]=60*h;ca()[b>>2]=Number(d!=g);b=l=>{var x=Math.abs(l);return`UTC${0<=l?"-":"+"}${String(Math.floor(x/60)).padStart(2,"0")}${String(x%60).padStart(2,"0")}`};a=b(d);b=b(g);g<d?(Y(a,c,17),Y(b,e,17)):(Y(a,e,17),Y(b,c,17))},ib=()=>{},jb=()=>{Q+=1;throw"unwind";},lb=a=>{var b=n().length;a>>>=0;if(a<=b||2147483648<a)return!1;for(var c=1;4>=c;c*=2){var e=b*(1+.2/c);e=Math.min(e,a+100663296);a:{e=(Math.min(2147483648,65536*Math.ceil(Math.max(a,e)/65536))-
f.buffer.byteLength+65535)/65536;try{f.grow(e);m();var g=1;break a}catch(d){}g=void 0}if(g)return!0}return!1},Rb={},Tb=()=>{if(!Sb){var a={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:A||"./this.program"},b;for(b in Rb)void 0===Rb[b]?delete a[b]:a[b]=Rb[b];var c=[];for(b in a)c.push(`${b}=${a[b]}`);Sb=c}return Sb},Sb;
function mb(a,b){if(w)return T(8,1,a,b);var c=0;Tb().forEach((e,g)=>{var d=b+c;g=q()[a+4*g>>2]=d;for(d=0;d<e.length;++d)aa()[g++]=e.charCodeAt(d);aa()[g]=0;c+=e.length+1});return 0}function nb(a,b){if(w)return T(9,1,a,b);var c=Tb();q()[a>>2]=c.length;var e=0;c.forEach(g=>e+=g.length+1);q()[b>>2]=e;return 0}function ob(a){return w?T(10,1,a):52}function pb(a,b,c,e){return w?T(11,1,a,b,c,e):52}function qb(a,b,c,e,g){return w?T(12,1,a,b,c,e,g):70}var Ub=[null,[],[]];
function rb(a,b,c,e){if(w)return T(13,1,a,b,c,e);for(var g=0,d=0;d<c;d++){var h=q()[b>>2],l=q()[b+4>>2];b+=8;for(var x=0;x<l;x++){var p=n()[h+x],y=Ub[a];0===p||10===p?((1===a?ua:D)(Lb(y,0)),y.length=0):y.push(p)}g+=l}q()[e>>2]=g;return 0}var Vb=a=>{for(var b=0,c=0;c<a.length;++c){var e=a.charCodeAt(c);127>=e?b++:2047>=e?b+=2:55296<=e&&57343>=e?(b+=4,++c):b+=3}b+=1;c=R(b);Y(a,c,b);return c};w?U=!1:Db();
var Pb=[sb,Bb,Jb,Wa,Xa,Ya,db,gb,mb,nb,ob,pb,qb,rb],Ua,Z=function(){function a(c,e){Z=c.exports;Cb.push(Z.F);Ib=Z.M;Ha.unshift(Z.C);Fa=e;Ma();return Z}var b=ya();La();if(r.instantiateWasm)try{return r.instantiateWasm(b,a)}catch(c){D(`Module.instantiateWasm callback failed with error: ${c}`),t(c)}Pa||=Oa("stockfish.wasm")?"stockfish.wasm":r.locateFile?r.locateFile("stockfish.wasm",B):B+"stockfish.wasm";Ta(b,function(c){a(c.instance,c.module)}).catch(t);return{}}(),Wb=r._main=(a,b)=>(Wb=r._main=Z.D)(a,
b);r._uci_command=a=>(r._uci_command=Z.E)(a);var E=()=>(E=Z.G)(),za=(a,b,c,e,g,d)=>(za=Z.H)(a,b,c,e,g,d),Ea=()=>(Ea=Z.I)(),zb=(a,b,c,e,g)=>(zb=Z.J)(a,b,c,e,g),Fb=a=>(Fb=Z.K)(a),F=a=>(F=Z.L)(a),Qb=(a,b)=>(Qb=Z.N)(a,b),Nb=()=>(Nb=Z.O)(),Hb=(a,b)=>(Hb=Z.P)(a,b),S=a=>(S=Z.Q)(a),R=a=>(R=Z.R)(a),yb=()=>(yb=Z.S)();
r.ccall=(a,b,c,e)=>{var g={string:p=>{var y=0;null!==p&&void 0!==p&&0!==p&&(y=Vb(p));return y},array:p=>{var y=R(p.length);aa().set(p,y);return y}};a=r["_"+a];var d=[],h=0;if(e)for(var l=0;l<e.length;l++){var x=g[c[l]];x?(0===h&&(h=yb()),d[l]=x(e[l])):d[l]=e[l]}c=a(...d);return c=function(p){0!==h&&S(h);return"string"===b?p?Lb(n(),p):"":"boolean"===b?!!p:p}(c)};var Xb;L=function Yb(){Xb||Zb();Xb||(L=Yb)};
function $b(a=[]){var b=Wb;a.unshift(A);var c=a.length,e=R(4*(c+1)),g=e;a.forEach(h=>{q()[g>>2]=Vb(h);g+=4});q()[g>>2]=0;try{var d=b(c,e);M(d,!0)}catch(h){Ab(h)}}
function Zb(){var a=na;function b(){if(!Xb&&(Xb=!0,r.calledRun=!0,!I&&(w||V(Ha),w||V(Ia),ia(r),r.onRuntimeInitialized?.(),ac&&$b(a),!w))){if(r.postRun)for("function"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;){var c=r.postRun.shift();Ja.unshift(c)}V(Ja)}}if(!(0<K))if(w)ia(r),w||V(Ha),startWorker(r);else{if(r.preRun)for("function"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)Ga.unshift(r.preRun.shift());V(Ga);0<K||(r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},
1);b()},1)):b())}}if(r.preInit)for("function"==typeof r.preInit&&(r.preInit=[r.preInit]);0<r.preInit.length;)r.preInit.pop()();var ac=!0;r.noInitialRun&&(ac=!1);Zb();moduleRtn=ja;


  return moduleRtn;
}
);
})();
if (typeof exports === 'object' && typeof module === 'object')
  module.exports = Stockfish;
else if (typeof define === 'function' && define['amd'])
  define([], () => Stockfish);
var isPthread = globalThis.self?.name === 'em-pthread';
var isNode = typeof globalThis.process?.versions?.node == 'string';
if (isNode) isPthread = require('worker_threads').workerData === 'em-pthread'

// When running as a pthread, construct a new instance on startup
isPthread && Stockfish();
